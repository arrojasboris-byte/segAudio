<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Control Center Audio - Demo completa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Chart.js para los gr√°ficos -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      /* Tema oscuro por defecto */
      --bg-body: #020617;
      --bg-main: radial-gradient(circle at top left, #111827, #020617 55%);
      --bg-card: #020617;
      --bg-card-soft: #020617;
      --bg-elevated: #020617;
      --bg-sidebar: #020617;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --border-soft: #1f2937;
      --accent-red: #ff2440;
      --accent-red-soft: #fecaca;
      --accent-blue: #38bdf8;
      --accent-green: #22c55e;
      --accent-orange: #f97316;
      --chip-pendiente: #facc15;
      --chip-enproceso: #bef264;
      --chip-finalizada: #4ade80;
      --shadow-soft: 0 14px 30px rgba(0,0,0,.45);
    }

    body.theme-light {
      --bg-body: #f3f4f6;
      --bg-main: radial-gradient(circle at top left, #e5e7eb, #f9fafb 55%);
      --bg-card: #ffffff;
      --bg-card-soft: #f9fafb;
      --bg-elevated: #ffffff;
      --bg-sidebar: #020617; /* sidebar sigue negro en claro */
      --text-main: #020617;
      --text-muted: #6b7280;
      --border-soft: #d1d5db;
      --shadow-soft: 0 10px 25px rgba(15,23,42,.08);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    body {
      background: var(--bg-main);
      color: var(--text-main);
      display: flex;
    }

    .app {
      flex: 1;
      display: flex;
      min-height: 0;
    }

    /* SIDEBAR ----------------------------------------------------- */

    .sidebar {
      width: 240px;
      background: var(--bg-sidebar);
      border-right: 1px solid #000;
      padding: 18px 18px 24px;
      display: flex;
      flex-direction: column;
      gap: 24px;
      color: #e5e7eb;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-badge {
      width: 34px;
      height: 34px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #fee2e2, var(--accent-red));
      box-shadow: 0 0 18px rgba(248,113,113,0.7);
    }

    .logo-text {
      display: flex;
      flex-direction: column;
    }

    .logo-title {
      font-weight: 700;
      font-size: 1.05rem;
    }

    .logo-subtitle {
      font-size: .7rem;
      color: #9ca3af;
    }

    .section-title {
      font-size: .75rem;
      text-transform: uppercase;
      color: #6b7280;
      letter-spacing: .12em;
      margin-bottom: 8px;
    }

    .nav-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 10px;
      border-radius: 999px;
      font-size: .88rem;
      color: #9ca3af;
      cursor: pointer;
      transition: all .18s ease;
    }

    .nav-item span.icon {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: #020617;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: .75rem;
    }

    .nav-item.active {
      background: linear-gradient(90deg, #ff2440, #fb7185);
      color: #111827;
      font-weight: 600;
    }

    .nav-item.active span.icon {
      background: rgba(15,23,42,.2);
    }

    .nav-item:hover:not(.active) {
      background: rgba(31,41,55,0.7);
      color: #e5e7eb;
    }

    .sidebar-footer {
      margin-top: auto;
      font-size: .78rem;
      color: #9ca3af;
    }

    /* MAIN -------------------------------------------------------- */

    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 10px 16px 12px;
      gap: 8px;
      min-width: 0;
      min-height: 0;
    }

    .topbar {
      display: flex;
      align-items: center;
      gap: 12px;
      padding-bottom: 4px;
    }

    .search-input-wrapper {
      flex: 1;
      position: relative;
    }

    .search-input {
      width: 100%;
      background: var(--bg-card);
      border-radius: 999px;
      padding: 8px 12px 8px 32px;
      border: 1px solid var(--border-soft);
      color: var(--text-main);
      font-size: .86rem;
      outline: none;
    }

    .search-input::placeholder {
      color: var(--text-muted);
    }

    .search-icon {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: .8rem;
      color: var(--text-muted);
    }

    .btn {
      border-radius: 999px;
      padding: 7px 13px;
      border: 1px solid var(--border-soft);
      font-size: .8rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--bg-card);
      color: var(--text-main);
      white-space: nowrap;
      box-shadow: none;
    }

    .btn-pill-strong {
      background: linear-gradient(90deg, #ff2440, #fb7185);
      color: #111827;
      border-color: transparent;
      font-weight: 600;
    }

    body.theme-light .btn,
    body.theme-light .btn-pill-strong {
      box-shadow: 0 8px 16px rgba(15,23,42,.08);
    }

    .btn span.icon {
      font-size: .85rem;
    }

    .main-content {
      flex: 1;
      border-radius: 18px;
      background: var(--bg-card-soft);
      border: 1px solid var(--border-soft);
      padding: 10px 10px 12px;
      min-height: 0;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .page {
      display: none;
      flex: 1;
      min-height: 0;
    }
    .page.active {
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 0;
    }

    /* TARJETAS GENERALES ------------------------------------------ */

    .card {
      background: var(--bg-card);
      border-radius: 14px;
      padding: 10px;
      border: 1px solid var(--border-soft);
      box-shadow: var(--shadow-soft);
      min-width: 0;
    }

    .card-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .card-title {
      font-size: .9rem;
      font-weight: 600;
    }

    .badge-small {
      font-size: .7rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: #111827;
      color: var(--text-muted);
      border: 1px solid var(--border-soft);
    }

    /* DASHBOARD --------------------------------------------------- */

    .page-dashboard {
      gap: 10px;
    }

    .dashboard-top {
      display: grid;
      grid-template-columns: 2fr 1.6fr;
      gap: 10px;
      min-height: 0;
    }

    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 8px;
    }

    .kpi-card {
      border-radius: 12px;
      padding: 10px;
      background: var(--bg-card);
      border: 1px solid var(--border-soft);
    }

    .kpi-label {
      font-size: .78rem;
      color: var(--text-muted);
      margin-bottom: 3px;
    }

    .kpi-main {
      font-size: 1.35rem;
      font-weight: 700;
      display: flex;
      align-items: baseline;
      gap: 6px;
    }

    .kpi-tag {
      font-size: .72rem;
      border-radius: 999px;
      padding: 2px 6px;
      background: rgba(34,197,94,.12);
      color: #4ade80;
    }

    .kpi-tag.warn {
      background: rgba(234,179,8,.12);
      color: #fbbf24;
    }

    .kpi-secondary {
      font-size: .72rem;
      color: var(--text-muted);
      margin-top: 3px;
    }

    .chart-container {
      position: relative;
      width: 100%;
      height: 230px;
    }

    .dashboard-bottom {
      display: grid;
      grid-template-columns: 1.8fr 1.2fr;
      gap: 10px;
      min-height: 0;
    }

    .ranking-header,
    .ranking-row {
      display: grid;
      grid-template-columns: 1.2fr .8fr .8fr .8fr .8fr;
      column-gap: 8px;
      font-size: .76rem;
      padding: 4px 0;
      align-items: center;
    }

    .ranking-header {
      border-bottom: 1px solid var(--border-soft);
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .ranking-row:nth-child(even) {
      background: rgba(15,23,42,.5);
      border-radius: 6px;
      padding-inline: 4px;
    }

    .chip {
      border-radius: 999px;
      padding: 2px 6px;
      font-size: .7rem;
      border: 1px solid rgba(148,163,184,.6);
      background: rgba(15,23,42,.9);
    }

    /* CENTROS ----------------------------------------------------- */

    .page-centros {
      gap: 8px;
    }

    .centros-layout {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-height: 0;
    }

    .centros-top {
      flex: 0 0 320px;
      display: grid;
      grid-template-columns: minmax(260px, 0.9fr) minmax(360px, 1.2fr) minmax(260px, 0.9fr);
      gap: 8px;
      min-height: 0;
    }

    .delegados-list {
      max-height: 260px;
      overflow: auto;
      padding-top: 4px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .delegado-row {
      background: var(--bg-card-soft);
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      padding: 6px 8px 6px;
      cursor: pointer;
    }

    .delegado-row-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: .8rem;
    }

    .delegado-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      margin-right: 6px;
      flex-shrink: 0;
    }

    .delegado-name {
      display: flex;
      align-items: center;
      gap: 4px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .delegado-centros-count {
      font-size: .75rem;
      color: var(--text-muted);
    }

    .delegado-bar {
      margin-top: 4px;
      height: 4px;
      border-radius: 999px;
      background: rgba(148,163,184,.4);
      position: relative;
      overflow: hidden;
    }

    .delegado-bar-fill {
      position: absolute;
      inset: 0;
      border-radius: 999px;
    }

    .delegado-centros {
      margin-top: 4px;
      font-size: .72rem;
      color: var(--text-muted);
      display: none;
    }

    .delegado-row.open .delegado-centros {
      display: block;
    }

    /* Calendario */
    .calendar-wrapper {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .calendar-title {
      font-size: .95rem;
      font-weight: 600;
    }

    .calendar-nav {
      display: flex;
      gap: 4px;
    }

    .calendar-nav button {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: transparent;
      color: var(--text-main);
      cursor: pointer;
      font-size: .8rem;
    }

    .calendar-grid {
      flex: 1;
      display: grid;
      grid-template-rows: auto 1fr;
      gap: 4px;
      min-height: 0;
    }

    .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      font-size: .76rem;
      text-align: center;
      color: var(--text-muted);
    }

    .calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-auto-rows: 1fr;
      gap: 4px;
      min-height: 0;
    }

    .calendar-day {
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      background: var(--bg-card);
      font-size: .8rem;
      display: flex;
      align-items: flex-start;
      justify-content: flex-start;
      padding: 4px 6px;
      cursor: pointer;
      position: relative;
    }

    .calendar-day.out {
      opacity: .25;
    }

    .calendar-day-number {
      font-size: .8rem;
    }

    .calendar-day-marker {
      position: absolute;
      bottom: 4px;
      right: 6px;
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 2px solid transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: .65rem;
      background: rgba(234,179,8,.15);
      color: #eab308;
    }

    .calendar-day-marker.sonia {
      background: rgba(96,165,250,.15);
      color: #60a5fa;
    }

    .calendar-day-marker.ariannys {
      background: rgba(244,114,182,.18);
      color: #f472b6;
    }

    /* Visitas agendadas */

    .visitas-list {
      max-height: 260px;
      overflow: auto;
      padding-top: 4px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: .78rem;
    }

    .visita-row {
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      background: var(--bg-card);
      padding: 6px 7px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .visita-row-line {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .visita-row-main {
      font-size: .78rem;
      font-weight: 500;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .visita-row-secondary {
      font-size: .72rem;
      color: var(--text-muted);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .chip-estado {
      border-radius: 999px;
      padding: 2px 6px;
      font-size: .7rem;
      border: 1px solid transparent;
    }

    .chip-estado.pendiente {
      background: rgba(250,204,21,.15);
      color: #eab308;
      border-color: rgba(250,204,21,.5);
    }

    .chip-estado.enproceso {
      background: rgba(190,242,100,.15);
      color: #84cc16;
      border-color: rgba(132,204,22,.6);
    }

    .chip-estado.finalizada {
      background: rgba(74,222,128,.15);
      color: #22c55e;
      border-color: rgba(34,197,94,.6);
    }

    .visita-actions {
      display: flex;
      gap: 4px;
      justify-content: flex-end;
    }

    .btn-chip {
      font-size: .7rem;
      border-radius: 999px;
      padding: 2px 6px;
      border: 1px solid var(--border-soft);
      background: transparent;
      color: var(--text-main);
      cursor: pointer;
    }

    /* Tabla de centros */

    .centros-bottom {
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .table-wrapper {
      flex: 1;
      background: var(--bg-card);
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .table-header {
      padding: 8px 10px 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .table-header h3 {
      font-size: .9rem;
    }

    .table-scroll {
      flex: 1;
      overflow: auto;
      border-top: 1px solid var(--border-soft);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: .78rem;
    }

    thead {
      position: sticky;
      top: 0;
      background: var(--bg-card);
      z-index: 1;
    }

    th, td {
      padding: 5px 8px;
      border-bottom: 1px solid #0b1120;
      text-align: left;
      white-space: nowrap;
    }

    th {
      font-weight: 600;
      font-size: .75rem;
      color: var(--text-muted);
    }

    tbody tr:nth-child(even) {
      background: #020617;
    }

    tbody tr:hover {
      background: rgba(15,23,42,0.9);
    }

    .tag {
      border-radius: 999px;
      padding: 2px 6px;
      font-size: .7rem;
      border: 1px solid var(--border-soft);
      background: #0b1120;
    }

    .tag.exclusivo {
      background: rgba(22,163,74,0.15);
      color: var(--accent-green);
      border-color: rgba(22,163,74,0.7);
    }

    .tag.corner {
      background: rgba(37,99,235,0.15);
      color: var(--accent-blue);
      border-color: rgba(37,99,235,0.7);
    }

    .tag-aar {
      background: rgba(148,163,184,0.15);
      border-color: rgba(148,163,184,0.7);
      color: var(--text-muted);
    }
    .tag-aar.si {
      background: rgba(34,197,94,0.15);
      border-color: rgba(34,197,94,0.7);
      color: var(--accent-green);
    }
    .tag-aar.formacion {
      background: rgba(234,179,8,0.15);
      border-color: rgba(234,179,8,0.7);
      color: #eab308;
    }

    .btn-link {
      border: none;
      background: transparent;
      color: var(--accent-blue);
      cursor: pointer;
      font-size: .74rem;
      text-decoration: underline;
    }

    /* INFORME DE LA VISITA ---------------------------------------- */

    .page-informe {
      gap: 10px;
      overflow: auto;
    }

    .panel-datos-visita {
      display: grid;
      grid-template-columns: 2.1fr 2.1fr 1.2fr;
      gap: 10px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px 12px;
      font-size: .78rem;
    }

    .form-row {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .form-row label {
      font-size: .72rem;
      color: var(--text-muted);
    }

    .form-row input {
      padding: 4px 6px;
      border-radius: 8px;
      border: 1px solid var(--border-soft);
      background: var(--bg-card-soft);
      color: var(--text-main);
      font-size: .8rem;
      outline: none;
    }

    .btn-full {
      width: 100%;
      justify-content: center;
    }

    .panel-graficos {
      display: grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      grid-auto-rows: 220px;
      gap: 10px;
    }

    .panel-graficos .card {
      display: flex;
      flex-direction: column;
    }

    .panel-graficos .chart-container {
      flex: 1;
      height: auto;
    }

    .panel-inferior {
      display: grid;
      grid-template-columns: 1.4fr 1.6fr;
      gap: 10px;
    }

    .checklist-visita {
      font-size: .78rem;
    }

    .checklist-visita label {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
      cursor: pointer;
    }

    .imagenes-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 8px;
      font-size: .78rem;
    }

    .imagen-field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      align-items: flex-start;
    }

    .imagen-preview {
      width: 100%;
      aspect-ratio: 4/3;
      border-radius: 10px;
      border: 1px dashed var(--border-soft);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: .7rem;
      color: var(--text-muted);
      overflow: hidden;
    }

    .imagen-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .textarea-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      font-size: .78rem;
    }

    .textarea-field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .textarea-field label {
      font-size: .75rem;
      color: var(--text-muted);
    }

    .textarea-field textarea {
      min-height: 90px;
      resize: vertical;
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      background: var(--bg-card);
      color: var(--text-main);
      padding: 6px 7px;
      font-size: .8rem;
      outline: none;
    }

    .informe-footer {
      display: flex;
      justify-content: flex-end;
      margin-top: 4px;
    }

    /* MODAL VISITA ----------------------------------------------- */

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,.75);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    .modal {
      background: var(--bg-card);
      border-radius: 14px;
      padding: 14px;
      width: 420px;
      max-width: 95%;
      border: 1px solid var(--border-soft);
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .modal-header h3 {
      font-size: .95rem;
    }
    .modal-close {
      cursor: pointer;
      font-size: 1rem;
      color: var(--text-muted);
    }
    .modal-body {
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: .78rem;
    }

    .modal-body select,
    .modal-body input {
      padding: 4px 6px;
      border-radius: 8px;
      border: 1px solid var(--border-soft);
      background: var(--bg-card-soft);
      color: var(--text-main);
      font-size: .8rem;
      outline: none;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 10px;
    }

    /* PRINT ------------------------------------------------------ */

    @media print {
      body {
        background: #ffffff;
      }
      .sidebar,
      .topbar {
        display: none !important;
      }
      .main-content {
        border: none;
        padding: 0;
        box-shadow: none;
      }
      .page {
        display: none !important;
      }
      .page.active {
        display: block !important;
      }
    }
  </style>
</head>

<body>
<div class="app">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="logo">
      <div class="logo-badge"></div>
      <div class="logo-text">
        <span class="logo-title">Control Center Audio</span>
        <span class="logo-subtitle">Gesti√≥n de centros y visitas</span>
      </div>
    </div>

    <div>
      <div class="section-title">Secciones</div>
      <nav class="nav-list" id="navMenu">
        <div class="nav-item active" data-page="dashboard">
          <span class="icon">üè†</span> Dashboard
        </div>
        <div class="nav-item" data-page="centros">
          <span class="icon">üè¢</span> Centros
        </div>
        <div class="nav-item" data-page="informe">
          <span class="icon">üìã</span> Informe de la visita
        </div>
        <div class="nav-item">
          <span class="icon">üõ†</span> Servicios
        </div>
        <div class="nav-item">
          <span class="icon">üí≥</span> Ventas
        </div>
        <div class="nav-item">
          <span class="icon">üìä</span> Proyectos
        </div>
      </nav>
    </div>

    <div class="sidebar-footer">
      Versi√≥n demo ¬∑ Datos ficticios
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <div class="topbar">
      <div class="search-input-wrapper">
        <span class="search-icon">üîç</span>
        <input class="search-input" placeholder="Buscar por centro, propietario o delegado..." />
      </div>
      <button class="btn" id="btnTheme">
        <span class="icon">üåì</span> Oscuro / Claro
      </button>
      <button class="btn" id="btnSaveView">
        <span class="icon">üíæ</span> Guardar vista
      </button>
      <button class="btn" id="btnExportHtml">
        <span class="icon">‚¨áÔ∏è</span> Exportar HTML
      </button>
      <button class="btn" id="btnPrint">
        <span class="icon">üñ®</span> Imprimir
      </button>
      <button class="btn btn-pill-strong">
        <span class="icon">‚òÅÔ∏è</span> Actualizar datos nube
      </button>
    </div>

    <section class="main-content">
      <!-- DASHBOARD ------------------------------------------------>
      <section class="page page-dashboard active" data-page="dashboard">
        <div class="dashboard-top">
          <div class="card">
            <div class="card-header-row">
              <span class="card-title">Resumen general KPIs</span>
            </div>
            <div class="kpi-grid">
              <div class="kpi-card">
                <div class="kpi-label">Procesos</div>
                <div class="kpi-main">
                  <span id="kpiProcesos">92%</span>
                  <span class="kpi-tag">Objetivo 85‚Äì100%</span>
                </div>
                <div class="kpi-secondary">Promedio sobre centros visitados</div>
              </div>
              <div class="kpi-card">
                <div class="kpi-label">Conversi√≥n a prueba</div>
                <div class="kpi-main">
                  <span id="kpiConvPrueba">81%</span>
                  <span class="kpi-tag">√ìptimo 80%</span>
                </div>
                <div class="kpi-secondary">Media de centros en visitas</div>
              </div>
              <div class="kpi-card">
                <div class="kpi-label">Conversi√≥n a cierre</div>
                <div class="kpi-main">
                  <span id="kpiConvVenta">79%</span>
                  <span class="kpi-tag warn">Revisar seguimiento</span>
                </div>
                <div class="kpi-secondary">Incluye devoluciones</div>
              </div>
              <div class="kpi-card">
                <div class="kpi-label">Aplicaci√≥n HIT</div>
                <div class="kpi-main">
                  <span id="kpiHIT">86%</span>
                  <span class="kpi-tag">Sobre visitas</span>
                </div>
                <div class="kpi-secondary">Promedio de checklist</div>
              </div>
              <div class="kpi-card">
                <div class="kpi-label">Ayudas</div>
                <div class="kpi-main">
                  <span id="kpiAyudas">41%</span>
                </div>
                <div class="kpi-secondary">% con subvenci√≥n / ayuda asociada</div>
              </div>
              <div class="kpi-card">
                <div class="kpi-label">AAR / Procesos</div>
                <div class="kpi-main">
                  <span id="kpiAAR">64%</span>
                </div>
                <div class="kpi-secondary">% pacientes en AAR</div>
              </div>
              <div class="kpi-card">
                <div class="kpi-label">Formaciones</div>
                <div class="kpi-main">
                  <span id="kpiFormaciones">78%</span>
                </div>
                <div class="kpi-secondary">% centros con formaciones clave</div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header-row">
              <span class="card-title">Evoluci√≥n mensual (demo)</span>
            </div>
            <div class="chart-container">
              <canvas id="chartProcesosMes"></canvas>
            </div>
          </div>
        </div>

        <div class="dashboard-bottom">
          <div class="card">
            <div class="card-header-row">
              <span class="card-title">Procesos, HIT y √°reas de mejora (mes)</span>
            </div>
            <div class="chart-container">
              <canvas id="chartHitAreasMes"></canvas>
            </div>
          </div>

          <div class="card">
            <div class="card-header-row">
              <span class="card-title">Ranking r√°pido de delegados</span>
            </div>
            <div class="ranking-header">
              <span>Delegado</span><span>Procesos</span><span>Prueba</span><span>Venta</span><span>HIT</span>
            </div>
            <div id="rankingDelegados"></div>
          </div>
        </div>
      </section>

      <!-- CENTROS -------------------------------------------------->
      <section class="page page-centros" data-page="centros">
        <div class="centros-layout">
          <div class="centros-top">
            <!-- Delegados -->
            <article class="card">
              <div class="card-header-row">
                <span class="card-title">Centros y delegados</span>
                <span class="badge-small" id="badgeDelegados">‚Äì</span>
              </div>
              <div class="delegados-list" id="delegadosList"></div>
              <div style="display:flex; gap:6px; margin-top:8px;">
                <button class="btn btn-pill-strong" id="btnAddCentro">
                  <span class="icon">‚ûï</span> A√±adir centro
                </button>
                <button class="btn" id="btnAdjuntarCentros">
                  <span class="icon">üì§</span> Adjuntar centros (Excel)
                </button>
                <input type="file" id="inputCentrosExcel" accept=".xlsx,.xls" style="display:none" />
              </div>
            </article>

            <!-- Calendario -->
            <article class="card calendar-wrapper">
              <div class="calendar-header">
                <div class="calendar-nav">
                  <button id="calPrev">&lt;</button>
                </div>
                <div class="calendar-title" id="calTitle"></div>
                <div class="calendar-nav">
                  <button id="calNext">&gt;</button>
                </div>
              </div>
              <div class="calendar-grid">
                <div class="calendar-weekdays">
                  <div>L</div><div>M</div><div>X</div><div>J</div><div>V</div><div>S</div><div>D</div>
                </div>
                <div class="calendar-days" id="calendarDays"></div>
              </div>
            </article>

            <!-- Visitas -->
            <article class="card">
              <div class="card-header-row">
                <span class="card-title">Visitas agendadas</span>
              </div>
              <div class="visitas-list" id="visitasList"></div>
            </article>
          </div>

          <!-- Tabla de centros -->
          <div class="centros-bottom">
            <div class="table-wrapper">
              <div class="table-header">
                <h3>Listado de centros</h3>
                <span class="badge-small" id="centrosCountLabel">Centros mostrados: 0</span>
              </div>
              <div class="table-scroll">
                <table>
                  <thead>
                    <tr>
                      <th>C√≥digo</th>
                      <th>Propietario</th>
                      <th>Centro</th>
                      <th>Provincia</th>
                      <th>Delegado</th>
                      <th>Tipo</th>
                      <th>Informes</th>
                      <th>Centro AAR</th>
                    </tr>
                  </thead>
                  <tbody id="tablaCentrosBody"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- INFORME DE LA VISITA ------------------------------------>
      <section class="page page-informe" data-page="informe">
        <!-- Panel 1 datos del centro / visita -->
        <div class="panel-datos-visita">
          <article class="card">
            <div class="card-header-row">
              <span class="card-title">Datos del centro</span>
            </div>
            <div class="form-grid">
              <div class="form-row">
                <label>Centro</label>
                <input id="infCentro" readonly />
              </div>
              <div class="form-row">
                <label>Provincia</label>
                <input id="infProvincia" readonly />
              </div>
              <div class="form-row">
                <label>Delegado</label>
                <input id="infDelegado" readonly />
              </div>
              <div class="form-row">
                <label>Tipo</label>
                <input id="infTipo" readonly />
              </div>
              <div class="form-row">
                <label>Responsable audio</label>
                <input id="infRespAudio" readonly />
              </div>
              <div class="form-row">
                <label>Fecha visita</label>
                <input id="infFecha" readonly />
              </div>
            </div>
          </article>

          <article class="card">
            <div class="card-header-row">
              <span class="card-title">Equipo y servicio</span>
            </div>
            <div class="form-grid">
              <div class="form-row">
                <label>Audi√≥logo</label>
                <input id="infAudiologo" />
              </div>
              <div class="form-row">
                <label>Horas de servicio</label>
                <input id="infHorasServicio" />
              </div>
            </div>
          </article>

          <article class="card">
            <div class="card-header-row">
              <span class="card-title">Checklist</span>
            </div>
            <div style="margin-top:6px;">
              <button class="btn btn-pill-strong btn-full" id="btnAdjuntarChecklist">
                <span class="icon">üìé</span> Adjuntar checklist
              </button>
              <input type="file" id="inputChecklist" accept=".xlsx,.xls" style="display:none" />
            </div>
          </article>
        </div>

        <!-- Panel 2 KPIs y gr√°ficos -->
        <div class="panel-graficos">
          <article class="card">
            <div class="card-header-row">
              <span class="card-title">KPIs del centro</span>
            </div>
            <div style="font-size:.78rem; margin-top:4px;">
              <div>Procesos: <strong id="kpiCentroProcesos">‚Äì</strong></div>
              <div>Conv. a prueba: <strong id="kpiCentroPrueba">‚Äì</strong></div>
              <div>Conv. a venta: <strong id="kpiCentroVenta">‚Äì</strong></div>
              <div>Aplicaci√≥n HIT: <strong id="kpiCentroHit">‚Äì</strong></div>
            </div>
          </article>

          <article class="card">
            <div class="card-header-row">
              <span class="card-title">Procesos por mes (centro)</span>
            </div>
            <div class="chart-container">
              <canvas id="chartCentroProcesosMes"></canvas>
            </div>
          </article>

          <article class="card">
            <div class="card-header-row">
              <span class="card-title">HIT por mes (centro)</span>
            </div>
            <div class="chart-container">
              <canvas id="chartCentroHitMes"></canvas>
            </div>
          </article>

          <article class="card">
            <div class="card-header-row">
              <span class="card-title">√Åreas de mejora por mes</span>
            </div>
            <div class="chart-container">
              <canvas id="chartCentroAreasMes"></canvas>
            </div>
          </article>

          <article class="card">
            <div class="card-header-row">
              <span class="card-title">Top 10 √°reas de mejora</span>
            </div>
            <div class="chart-container">
              <canvas id="chartCentroTopAreas"></canvas>
            </div>
          </article>

          <article class="card">
            <div class="card-header-row">
              <span class="card-title">AAR / Procesos (centro)</span>
            </div>
            <div class="chart-container">
              <canvas id="chartCentroAAR"></canvas>
            </div>
          </article>
        </div>

        <!-- Panel 3 checklist interno + im√°genes -->
        <div class="panel-inferior">
          <article class="card">
            <div class="card-header-row">
              <span class="card-title">Formaciones y habilidades</span>
            </div>
            <div class="checklist-visita" style="margin-top:6px;">
              <!-- Solo visual, l√≥gica la a√±adimos despu√©s -->
              <label><input type="checkbox" /> WSA</label>
              <label><input type="checkbox" /> Starkey</label>
              <label><input type="checkbox" /> Habilidades comerciales / Neuroventas</label>
              <label><input type="checkbox" /> HIT</label>
              <label><input type="checkbox" /> Telecare</label>
              <label><input type="checkbox" /> PIA</label>
              <label><input type="checkbox" /> Telehear</label>
              <label><input type="checkbox" /> Financiaci√≥n Infinity</label>
              <label><input type="checkbox" /> Venta de seguro</label>
              <label><input type="checkbox" /> Primeros auxilios (equipo)</label>
              <label><input type="checkbox" /> Implementaci√≥n en punto de venta</label>
              <label><input type="checkbox" /> Audiometr√≠a RT</label>
              <label><input type="checkbox" /> Test de lectura audio</label>
              <label><input type="checkbox" /> Screening audio</label>
              <label><input type="checkbox" /> Manteleta audio</label>
              <label><input type="checkbox" /> Escaparate visible audio</label>
              <label><input type="checkbox" /> Salud auditiva en PDV</label>
              <label><input type="checkbox" /> Elementos Renove</label>
              <label><input type="checkbox" /> Elementos MGM</label>
              <label><input type="checkbox" /> Stock</label>
              <label><input type="checkbox" /> Tchin Tchin</label>
            </div>
          </article>

          <article class="card">
            <div class="card-header-row">
              <span class="card-title">Im√°genes del centro</span>
            </div>
            <div class="imagenes-grid" style="margin-top:6px;">
              <div class="imagen-field">
                <span>Centro exterior</span>
                <label class="imagen-preview">
                  <span>Adjuntar imagen</span>
                  <input type="file" accept="image/*" style="display:none" />
                </label>
              </div>
              <div class="imagen-field">
                <span>Centro interior</span>
                <label class="imagen-preview">
                  <span>Adjuntar imagen</span>
                  <input type="file" accept="image/*" style="display:none" />
                </label>
              </div>
              <div class="imagen-field">
                <span>Gabinete</span>
                <label class="imagen-preview">
                  <span>Adjuntar imagen</span>
                  <input type="file" accept="image/*" style="display:none" />
                </label>
              </div>
            </div>
          </article>
        </div>

        <!-- Panel 4 observaciones / recomendaciones / compromisos -->
        <article class="card">
          <div class="textarea-grid">
            <div class="textarea-field">
              <label>Observaciones</label>
              <textarea id="infObs"></textarea>
            </div>
            <div class="textarea-field">
              <label>Recomendaciones</label>
              <textarea id="infRec"></textarea>
            </div>
            <div class="textarea-field">
              <label>Compromisos</label>
              <textarea id="infComp"></textarea>
            </div>
          </div>
          <div class="informe-footer">
            <button class="btn btn-pill-strong" id="btnGuardarInforme">
              <span class="icon">üíæ</span> Guardar informe
            </button>
          </div>
        </article>
      </section>
    </section>
  </main>
</div>

<!-- Modal agendar visita -->
<div class="modal-backdrop" id="modalVisita">
  <div class="modal">
    <div class="modal-header">
      <h3>Nueva visita</h3>
      <span class="modal-close" data-close="modalVisita">‚úï</span>
    </div>
    <div class="modal-body">
      <div>
        <label>Fecha</label>
        <input id="visitaFecha" readonly />
      </div>
      <div>
        <label>Responsable de audio</label>
        <select id="visitaRespAudio">
          <option value="Ariannys Rojas">Ariannys Rojas</option>
          <option value="Sonia Guasque">Sonia Guasque</option>
        </select>
      </div>
      <div>
        <label>Centro</label>
        <input id="visitaCentro" placeholder="Escribe nombre de centro..." />
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn" data-close="modalVisita">Cancelar</button>
      <button class="btn btn-pill-strong" id="visitaGuardar">Guardar</button>
    </div>
  </div>
</div>

<script>
  /* --------- Navegaci√≥n entre m√≥dulos --------- */
  const navItems = document.querySelectorAll("#navMenu .nav-item");
  const pages = document.querySelectorAll(".page");

  navItems.forEach(item => {
    item.addEventListener("click", () => {
      const page = item.dataset.page;
      navItems.forEach(i => i.classList.toggle("active", i === item));
      pages.forEach(p => p.classList.toggle("active", p.dataset.page === page));
    });
  });

  /* --------- Tema oscuro / claro --------- */
  const btnTheme = document.getElementById("btnTheme");
  btnTheme.addEventListener("click", () => {
    document.body.classList.toggle("theme-light");
  });

  /* --------- Guardar vista (demo) --------- */
  document.getElementById("btnSaveView").addEventListener("click", () => {
    alert("En la versi√≥n demo solo guardamos la vista de forma simb√≥lica.");
  });

  /* --------- Exportar HTML --------- */
  document.getElementById("btnExportHtml").addEventListener("click", () => {
    const blob = new Blob([document.documentElement.outerHTML], { type: "text/html" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "control-center-audio.html";
    a.click();
    URL.revokeObjectURL(url);
  });

  /* --------- Imprimir m√≥dulo activo --------- */
  document.getElementById("btnPrint").addEventListener("click", () => {
    window.print();
  });

  /* ==================== DASHBOARD (demo visual) ====================== */

  const ctxProcMes = document.getElementById("chartProcesosMes").getContext("2d");
  new Chart(ctxProcMes, {
    type: "line",
    data: {
      labels: ["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],
      datasets: [
        { label:"Procesos", data:[81,84,86,88,87,90,91,92,93,94,93,92], borderWidth:2, tension:.35 },
        { label:"HIT", data:[82,83,84,85,85,86,87,88,89,88,87,88], borderWidth:2, borderDash:[4,4], tension:.35 }
      ]
    },
    options: {
      responsive:true,
      maintainAspectRatio:false,
      plugins:{ legend:{ labels:{ color:getComputedStyle(document.body).getPropertyValue("--text-main"), font:{size:11} } } },
      scales:{
        x:{ ticks:{ color:getComputedStyle(document.body).getPropertyValue("--text-muted"), font:{size:10} },
            grid:{ color:"rgba(31,41,55,0.4)" } },
        y:{ ticks:{ color:getComputedStyle(document.body).getPropertyValue("--text-muted"), font:{size:10} },
            grid:{ color:"rgba(31,41,55,0.4)" } }
      }
    }
  });

  const ctxHitAreasMes = document.getElementById("chartHitAreasMes").getContext("2d");
  new Chart(ctxHitAreasMes, {
    type:"bar",
    data:{
      labels:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],
      datasets:[
        { label:"Procesos", data:[80,82,84,86,87,89,90,91,92,93,92,91] },
        { label:"HIT", data:[78,79,80,82,83,84,85,86,87,87,86,87] },
        { label:"√Åreas de mejora", data:[5,6,5,4,4,3,3,3,2,2,3,2] }
      ]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      plugins:{ legend:{ labels:{ color:getComputedStyle(document.body).getPropertyValue("--text-main"), font:{size:11} } } },
      scales:{
        x:{ ticks:{ color:getComputedStyle(document.body).getPropertyValue("--text-muted"), font:{size:10} },
            grid:{ color:"rgba(31,41,55,0.3)" } },
        y:{ ticks:{ color:getComputedStyle(document.body).getPropertyValue("--text-muted"), font:{size:10} },
            grid:{ color:"rgba(31,41,55,0.3)" } }
      }
    }
  });

  // Ranking demo
  const rankingData = [
    { nombre:"Blanca Fdez. de la Pradilla", procesos:93, prueba:84, venta:80, hit:89 },
    { nombre:"Sergio Per√°n", procesos:91, prueba:83, venta:81, hit:88 },
    { nombre:"Sonia Godino", procesos:89, prueba:82, venta:80, hit:87 },
    { nombre:"Daniel Chazo", procesos:88, prueba:81, venta:79, hit:86 },
    { nombre:"Marisa Carmona", procesos:87, prueba:80, venta:78, hit:85 }
  ];
  const rankingContainer = document.getElementById("rankingDelegados");
  rankingData.forEach(d => {
    const row = document.createElement("div");
    row.className = "ranking-row";
    row.innerHTML = `
      <span>${d.nombre}</span>
      <span>${d.procesos}%</span>
      <span>${d.prueba}%</span>
      <span>${d.venta}%</span>
      <span>${d.hit}%</span>
    `;
    rankingContainer.appendChild(row);
  });

  /* ==================== CENTROS (maqueta) ============================ */

  const centrosDemo = [
    { codigo:"4ABB", propietario:"MAZA Oriol", centro:"PAMPLONA C. Exclusivo", provincia:"NAVARRA", delegado:"Sonia Godino", tipo:"Exclusivo", aar:"En formaci√≥n" },
    { codigo:"4AFH", propietario:"MAZA Oriol", centro:"PAMPLONA Calle Sancho el Mayor", provincia:"NAVARRA", delegado:"Sonia Godino", tipo:"Exclusivo", aar:"No" },
    { codigo:"4AWQ", propietario:"MAZA Oriol", centro:"PAMPLONA Carlos III", provincia:"NAVARRA", delegado:"Sonia Godino", tipo:"Exclusivo", aar:"No" },
    { codigo:"4MRM", propietario:"AAO", centro:"REINA DE MERCEDES", provincia:"Madrid", delegado:"Sergio Per√°n", tipo:"Exclusivo", aar:"S√≠" },
    { codigo:"4PEC", propietario:"AAO", centro:"SANTANDER CC PE√ëACASTILLO", provincia:"Santander", delegado:"Sergio Per√°n", tipo:"Exclusivo", aar:"No" },
    { codigo:"4AXF", propietario:"URRUTIA Esteban", centro:"SANTIAGO DE COMPOSTELA RUA DA ROSA", provincia:"A Coru√±a", delegado:"Daniel Chazo", tipo:"Exclusivo", aar:"En formaci√≥n" },
    { codigo:"4TOL", propietario:"AAO", centro:"TORRELAVEGA CARREFOUR CC", provincia:"Santander", delegado:"Sergio Per√°n", tipo:"Exclusivo", aar:"No" },
    { codigo:"4ZDE", propietario:"AAO", centro:"ZARAGOZA CALLE DELICIAS", provincia:"ZARAGOZA", delegado:"ENERITZ ARANGUREN", tipo:"Exclusivo", aar:"No" },
    { codigo:"4AKI", propietario:"PIEDRAFITA Rocio", centro:"CC LOS VALLES", provincia:"MADRID", delegado:"Blanca Fdez. de la Pradilla", tipo:"Exclusivo", aar:"No" },
    { codigo:"4MLG", propietario:"AAO", centro:"FUENLABRADA Calle Leganes", provincia:"MADRID", delegado:"Marisa Carmona", tipo:"Exclusivo", aar:"No" }
  ];

  const tablaCentrosBody = document.getElementById("tablaCentrosBody");
  const centrosCountLabel = document.getElementById("centrosCountLabel");

  function renderTablaCentros() {
    tablaCentrosBody.innerHTML = "";
    centrosDemo.forEach(c => {
      const tr = document.createElement("tr");
      const tipoClass = c.tipo === "Exclusivo" ? "exclusivo" : "corner";
      let aarClass = "";
      if (c.aar === "S√≠") aarClass = "si";
      else if (c.aar === "En formaci√≥n") aarClass = "formacion";

      tr.innerHTML = `
        <td>${c.codigo}</td>
        <td>${c.propietario}</td>
        <td>${c.centro}</td>
        <td>${c.provincia}</td>
        <td>${c.delegado}</td>
        <td><span class="tag ${tipoClass}">${c.tipo}</span></td>
        <td><button class="btn-link btn-informe-centro" data-centro="${c.centro}">A√±adir informe</button></td>
        <td><span class="tag tag-aar ${aarClass}">${c.aar}</span></td>
      `;
      tablaCentrosBody.appendChild(tr);
    });
    centrosCountLabel.textContent = `Centros mostrados: ${centrosDemo.length} / ${centrosDemo.length}`;
  }

  renderTablaCentros();

  // Delegados barras
  const delegadosList = document.getElementById("delegadosList");
  const badgeDelegados = document.getElementById("badgeDelegados");

  function renderDelegados() {
    const map = new Map();
    centrosDemo.forEach(c => {
      if (!map.has(c.delegado)) map.set(c.delegado, []);
      map.get(c.delegado).push(c.centro);
    });
    delegadosList.innerHTML = "";
    const colores = [
      "#ec4899","#22c55e","#38bdf8","#f97316","#a855f7",
      "#eab308","#14b8a6","#fb7185"
    ];
    let idx = 0;
    map.forEach((centros, delegado) => {
      const color = colores[idx % colores.length]; idx++;
      const row = document.createElement("div");
      row.className = "delegado-row";
      row.innerHTML = `
        <div class="delegado-row-header">
          <div class="delegado-name">
            <span class="delegado-dot" style="background:${color}"></span>
            <span>${delegado}</span>
          </div>
          <span class="delegado-centros-count">${centros.length} centros</span>
        </div>
        <div class="delegado-bar">
          <div class="delegado-bar-fill" style="background:${color}"></div>
        </div>
        <div class="delegado-centros">${centros.join(" ¬∑ ")}</div>
      `;
      row.addEventListener("click", () => {
        row.classList.toggle("open");
      });
      delegadosList.appendChild(row);
    });
    badgeDelegados.textContent = `${map.size} delegados`;
  }

  renderDelegados();

  /* ------- Calendario simple + visitas demo -------- */

  const calTitle = document.getElementById("calTitle");
  const calDaysContainer = document.getElementById("calendarDays");
  let calDate = new Date();

  const visitas = []; // [{date: '2025-12-12', centro, delegado, respAudio, estado}]

  function formatDateISO(d) {
    return d.toISOString().slice(0,10);
  }

  function renderCalendar() {
    const year = calDate.getFullYear();
    const month = calDate.getMonth();
    const firstDay = new Date(year, month, 1);
    const firstWeekDay = (firstDay.getDay()+6)%7; // lunes=0
    const daysInMonth = new Date(year, month+1,0).getDate();
    const prevMonthDays = new Date(year, month,0).getDate();

    calTitle.textContent = new Date(year, month, 1).toLocaleDateString("es-ES", { month:"long", year:"numeric" }).replace(/^\w/, c=>c.toUpperCase());

    calDaysContainer.innerHTML = "";
    const totalCells = 42;
    for (let i=0;i<totalCells;i++) {
      const cell = document.createElement("div");
      cell.className = "calendar-day";
      let dayNum, cellDate, out=false;
      if (i < firstWeekDay) {
        dayNum = prevMonthDays-firstWeekDay+1+i;
        cellDate = new Date(year, month-1, dayNum);
        out=true;
      } else if (i >= firstWeekDay+daysInMonth) {
        dayNum = i-firstWeekDay-daysInMonth+1;
        cellDate = new Date(year, month+1, dayNum);
        out=true;
      } else {
        dayNum = i-firstWeekDay+1;
        cellDate = new Date(year, month, dayNum);
      }
      if (out) cell.classList.add("out");
      const span = document.createElement("span");
      span.className = "calendar-day-number";
      span.textContent = dayNum;
      cell.appendChild(span);

      const iso = formatDateISO(cellDate);
      const v = visitas.find(v => v.fecha === iso);
      if (v) {
        const mark = document.createElement("div");
        mark.className = "calendar-day-marker " + (v.respAudio.startsWith("Sonia") ? "sonia" : "ariannys");
        mark.textContent = v.respAudio.startsWith("Sonia") ? "S" : "A";
        cell.appendChild(mark);
      }

      cell.addEventListener("click", () => {
        abrirModalVisita(cellDate);
      });

      calDaysContainer.appendChild(cell);
    }
  }

  document.getElementById("calPrev").addEventListener("click", () => {
    calDate.setMonth(calDate.getMonth()-1);
    renderCalendar();
  });
  document.getElementById("calNext").addEventListener("click", () => {
    calDate.setMonth(calDate.getMonth()+1);
    renderCalendar();
  });

  const visitasList = document.getElementById("visitasList");

  function renderVisitas() {
    visitasList.innerHTML = "";
    visitas.sort((a,b) => a.fecha.localeCompare(b.fecha));
    visitas.forEach(v => {
      const row = document.createElement("div");
      row.className = "visita-row";
      row.innerHTML = `
        <div class="visita-row-line">
          <span class="visita-row-main">${v.fecha} ¬∑ ${v.centro}</span>
          <span class="chip-estado ${v.estado}">${v.estado === "pendiente" ? "Pendiente" : v.estado === "enproceso" ? "En proceso" : "Finalizada"}</span>
        </div>
        <div class="visita-row-secondary">
          Del. ${v.delegado} ¬∑ Resp. Audio ${v.respAudio}
        </div>
        <div class="visita-actions">
          <button class="btn-chip btn-ir-informe" data-centro="${v.centro}" data-fecha="${v.fecha}">Informe</button>
        </div>
      `;
      visitasList.appendChild(row);
    });
  }

  // Modal visita
  const modalVisita = document.getElementById("modalVisita");
  const visitaFechaInput = document.getElementById("visitaFecha");
  const visitaRespAudio = document.getElementById("visitaRespAudio");
  const visitaCentroInput = document.getElementById("visitaCentro");

  function abrirModalVisita(date) {
    visitaFechaInput.value = formatDateISO(date);
    visitaCentroInput.value = "";
    visitaRespAudio.value = "Ariannys Rojas";
    modalVisita.style.display = "flex";
  }

  document.querySelectorAll("[data-close='modalVisita']").forEach(el => {
    el.addEventListener("click", () => modalVisita.style.display = "none");
  });

  document.getElementById("visitaGuardar").addEventListener("click", () => {
    const fecha = visitaFechaInput.value;
    const resp = visitaRespAudio.value;
    const centro = visitaCentroInput.value || "Centro sin nombre";
    const del = "Delegado demo";
    visitas.push({ fecha, respAudio:resp, centro, delegado:del, estado:"pendiente" });
    modalVisita.style.display = "none";
    renderCalendar();
    renderVisitas();
  });

  // Abrir informe desde tabla de centros / visitas (solo precarga visual)
  function irAInforme(centro, fecha) {
    const c = centrosDemo.find(x => x.centro === centro) || centrosDemo[0];
    document.querySelectorAll(".nav-item").forEach(i => {
      i.classList.toggle("active", i.dataset.page === "informe");
    });
    pages.forEach(p => p.classList.toggle("active", p.dataset.page === "informe"));

    document.getElementById("infCentro").value = c.centro;
    document.getElementById("infProvincia").value = c.provincia;
    document.getElementById("infDelegado").value = c.delegado;
    document.getElementById("infTipo").value = c.tipo;
    document.getElementById("infRespAudio").value = "Ariannys Rojas / Sonia Guasque";
    document.getElementById("infFecha").value = fecha || formatDateISO(new Date());
  }

  document.addEventListener("click", e => {
    if (e.target.matches(".btn-informe-centro")) {
      irAInforme(e.target.dataset.centro);
    }
    if (e.target.matches(".btn-ir-informe")) {
      irAInforme(e.target.dataset.centro, e.target.dataset.fecha);
    }
  });

  /* -------------- Informe: im√°genes (preview simple) ---------- */

  document.querySelectorAll(".imagen-preview").forEach(wrapper => {
    const input = wrapper.querySelector("input[type=file]");
    input.addEventListener("change", e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = ev => {
        wrapper.innerHTML = `<img src="${ev.target.result}" alt="imagen" />`;
        wrapper.appendChild(input);
        input.style.display = "none";
      };
      reader.readAsDataURL(file);
    });
    wrapper.addEventListener("click", () => input.click());
  });

  /* -------------- Informe: guardar (demo) ---------------------- */
  document.getElementById("btnGuardarInforme").addEventListener("click", () => {
    alert("Informe guardado (demo). En la versi√≥n l√≥gica se actualizar√°n estados y KPIs.");
  });

  /* -------------- Checklist (solo adjuntar visualmente) --------- */
  document.getElementById("btnAdjuntarChecklist").addEventListener("click", () => {
    document.getElementById("inputChecklist").click();
  });
  document.getElementById("inputChecklist").addEventListener("change", e => {
    if (e.target.files[0]) {
      alert("Checklist cargado (maqueta visual). Luego conectamos la l√≥gica de KPIs.");
    }
  });

  /* Inicializaci√≥n */
  renderCalendar();
  renderVisitas();
</script>
</body>
</html>
